# Enable code coverage if CMAKE_BUILD_TYPE is set to 'Coverage'
if(CMAKE_BUILD_TYPE MATCHES Coverage)
    message(STATUS "Code Coverage enabled")
    # Set the compiler flags for coverage
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} --coverage")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} --coverage")
endif()


- script: |
    lcov --capture --directory . --output-file coverage.info
    lcov --remove coverage.info '/usr/*' '*/test/*' '*/googletest/*' --output-file coverage_filtered.info
    genhtml coverage_filtered.info --output-directory coverage_report
  displayName: 'Generate Code Coverage Report'


- task: PublishBuildArtifacts@1
  inputs:
    pathtoPublish: '$(Build.SourcesDirectory)/coverage_report'
    artifactName: 'coverage_report'
    publishLocation: 'Container'
  displayName: 'Publish Code Coverage Report'
