# Step 3: Build Docker image only if all tests pass
- task: Docker@2
  condition: succeeded()
  inputs:
    containerRegistry: '<your-container-registry-service-connection>'
    repository: '$(dockerImageName)'
    command: 'buildAndPush'
    Dockerfile: '$(Build.SourcesDirectory)/Dockerfile'
    tags: |
      $(Build.BuildId)

# Optional: Run the Docker image to verify it works
- script: |
    docker run --rm $(dockerImageName):$(Build.BuildId)
  condition: succeeded()
  displayName: 'Run Docker Image'
